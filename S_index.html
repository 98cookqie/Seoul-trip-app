<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>首爾冬日旅 | Seoul Trip</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=Noto+Serif+TC:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- FontAwesome (Icons) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        muji: {
                            bg: '#fdfcf8',
                            card: '#ffffff',
                            text: '#44403c',
                            sub: '#78716c',
                            accent: '#a8a29e',
                            primary: '#57534e',
                            highlight: '#d97706'
                        }
                    },
                    fontFamily: {
                        sans: ['"Noto Sans TC"', 'sans-serif'],
                        serif: ['"Noto Serif TC"', 'serif'],
                    }
                }
            }
        }
    </script>

    <style>
        /* Global & Reset */
        body {
            background-color: #fdfcf8;
            color: #44403c;
            -webkit-tap-highlight-color: transparent;
            width: 100vw;
            height: 100dvh; /* Dynamic Viewport Height */
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* 頁面切換動畫 */
        .page-section {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
            padding-bottom: 120px; /* 避開底部導航 */
            width: 100%;
        }
        .page-section.active { display: block; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Modal */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); backdrop-filter: blur(2px); z-index: 999; display: none; opacity: 0; transition: opacity 0.3s ease; }
        .modal-overlay.active { display: block; opacity: 1; }
        .modal-content { position: absolute; bottom: 0; left: 0; width: 100%; max-height: 85%; background: #fdfcf8; border-top-left-radius: 20px; border-top-right-radius: 20px; transform: translateY(100%); transition: transform 0.3s ease-out; box-shadow: 0 -10px 40px rgba(0,0,0,0.15); overflow-y: auto; }
        .modal-overlay.active .modal-content { transform: translateY(0); }

        /* Input Styles */
        .input-ghost { background: transparent; border: none; outline: none; width: 100%; }
        .muji-checkbox:checked { background-color: #57534e; border-color: #57534e; }

        /* Intro Animation */
        #intro-overlay {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background-color: #fdfcf8; z-index: 9999;
            display: flex; justify-content: center; align-items: center;
            overflow: hidden; pointer-events: none;
            animation: hideIntro 0.5s ease-out 2.8s forwards;
        }
        #intro-text {
            font-family: 'Noto Serif TC', serif; font-size: 4rem; font-weight: 700;
            color: #44403c; letter-spacing: 0.1em; text-transform: uppercase;
            animation: zoomText 3s cubic-bezier(0.7, 0, 0.3, 1) forwards;
            transform-origin: 20% 50%;
        }
        .intro-s {
            display: inline-block; background-clip: text; -webkit-background-clip: text;
            color: #44403c; animation: colorMorph 3s ease-in-out forwards;
        }
        @keyframes zoomText {
            0% { transform: scale(0.8); opacity: 0; }
            15% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.5); opacity: 1; }
            100% { transform: scale(50); opacity: 0; }
        }
        @keyframes colorMorph {
            0%, 20% { color: #44403c; }
            40% { color: transparent; background-image: linear-gradient(135deg, #FF9A9E 0%, #FECFEF 100%); }
            100% { color: transparent; background-image: linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%); }
        }
        @keyframes hideIntro { to { opacity: 0; visibility: hidden; } }
    </style>
</head>
<body class="font-sans antialiased">

    <!-- INTRO ANIMATION -->
    <div id="intro-overlay">
        <h1 id="intro-text"><span class="intro-s">S</span>EOUL</h1>
    </div>

    <!-- Header -->
    <header class="bg-muji-bg px-6 pt-12 pb-4 sticky top-0 z-10 border-b border-stone-200/50 w-full">
        <div class="flex justify-between items-end">
            <div>
                <h1 class="font-serif text-3xl text-stone-800 tracking-wide font-bold">SEOUL</h1>
                <p class="text-sm text-muji-sub mt-1 tracking-widest uppercase">Dec 18 - Dec 21, 2024</p>
            </div>
            <!-- Removed Right Side Weather/Temp -->
        </div>
    </header>

    <!-- Main Content Container -->
    <main class="flex-1 overflow-y-auto overflow-x-hidden no-scrollbar relative w-full" id="main-container">

        <!-- ================= SECTION 1: PLAN (行程) ================= -->
        <div id="section-plan" class="page-section active">
            <div class="flex overflow-x-auto no-scrollbar px-6 py-4 gap-3 sticky top-0 bg-muji-bg/95 backdrop-blur-sm z-10 w-full" id="day-tabs">
                <!-- Javascript renders tabs -->
            </div>
            <div id="itinerary-content" class="px-6 pb-8 space-y-4 w-full">
                <!-- Javascript renders cards -->
            </div>
        </div>

        <!-- ================= SECTION 2: WALLET (記帳) ================= -->
        <div id="section-wallet" class="page-section">
            <div class="bg-stone-100 p-6 pb-8 rounded-b-3xl shadow-inner mb-6 w-full">
                <!-- Rate -->
                <div class="flex flex-wrap justify-between items-center mb-4 gap-2">
                    <label class="text-xs font-bold text-muji-sub uppercase tracking-wider">Exchange Rate</label>
                    <div class="flex items-center bg-white rounded-lg px-2 py-1 shadow-sm">
                        <span class="text-xs text-stone-400 mr-2">1 TWD ≈</span>
                        <input type="number" id="exchange-rate" value="42.5" class="w-10 text-right text-sm font-bold text-stone-700 outline-none bg-transparent" onchange="updateRate()">
                        <span class="text-xs text-stone-400 ml-1">KRW</span>
                    </div>
                </div>

                <!-- Calculator -->
                <div class="bg-white rounded-xl p-4 shadow-sm border border-stone-200 w-full">
                    <div class="flex flex-col">
                        <label class="text-xs text-muji-sub mb-1">快速換算</label>
                        <!-- Input Row -->
                        <div class="mb-2 w-full">
                            <input type="number" inputmode="decimal" id="calc-input" placeholder="例如: 5000" class="w-full text-xl font-mono text-stone-800 border-b border-stone-200 focus:border-muji-primary outline-none py-1 bg-transparent" oninput="calculateTotal()">
                        </div>
                        <!-- Result Row -->
                        <div class="flex justify-between items-end w-full">
                            <span class="text-stone-400 text-xl">=</span>
                            <div class="text-right flex-1 pl-2">
                                <div id="calc-result-krw" class="text-xs text-stone-500 truncate">0 ₩</div>
                                <div id="calc-result-twd" class="text-2xl font-bold text-muji-highlight break-all leading-none">0 NT$</div>
                            </div>
                        </div>
                    </div>
                    <button onclick="copyCalcToExpense()" class="w-full mt-3 bg-stone-100 text-stone-600 text-xs py-2 rounded-lg hover:bg-stone-200 transition"><i class="fa-solid fa-arrow-down mr-1"></i> 填入記帳金額</button>
                </div>
            </div>

            <!-- Expense Form -->
            <div class="px-6 mb-8 w-full">
                <h3 class="font-serif text-lg mb-4">新增消費</h3>
                <div class="flex flex-col gap-3">
                    <div class="flex gap-2 w-full">
                        <input type="text" id="expense-name" placeholder="品項" class="flex-[2] bg-white border border-stone-200 rounded-lg px-3 py-3 text-sm outline-none min-w-0">
                        <select id="expense-payer" class="flex-[1] bg-white border border-stone-200 rounded-lg px-2 py-3 text-sm outline-none focus:border-muji-primary text-stone-700 min-w-0">
                            <option value="Kathy">Kathy</option>
                            <option value="Nick">Nick</option>
                        </select>
                    </div>
                    <input type="number" inputmode="decimal" id="expense-amount" placeholder="₩ 韓幣金額" class="w-full bg-white border border-stone-200 rounded-lg px-3 py-3 text-sm outline-none">
                    
                    <button onclick="addExpense()" class="w-full bg-muji-primary text-white py-3 rounded-lg shadow-md active:scale-95 transition text-sm font-medium tracking-wide">
                        記一筆
                    </button>
                </div>
            </div>

            <!-- Expense List -->
            <div class="px-6 w-full">
                <div class="grid grid-cols-2 gap-3 mb-6">
                    <div class="bg-stone-50 p-3 rounded-lg border border-stone-200 text-center"><span class="block text-xs text-stone-400 mb-1">Kathy Paid</span><span id="total-kathy" class="font-bold text-stone-700">NT$ 0</span></div>
                    <div class="bg-stone-50 p-3 rounded-lg border border-stone-200 text-center"><span class="block text-xs text-stone-400 mb-1">Nick Paid</span><span id="total-nick" class="font-bold text-stone-700">NT$ 0</span></div>
                </div>

                <div class="flex justify-between items-end mb-4 border-b border-stone-200 pb-2">
                    <h3 class="font-serif text-lg">消費紀錄</h3>
                    <div class="text-right"><span class="text-xs text-muji-sub block">總支出 (預估)</span><span id="total-twd" class="font-bold text-muji-text">NT$ 0</span></div>
                </div>
                <ul id="expense-list" class="space-y-3 pb-20 w-full">
                    <!-- Javascript will render list here -->
                </ul>
            </div>
        </div>

        <!-- ================= SECTION 3: LISTS (清單) ================= -->
        <div id="section-lists" class="page-section">
            <div class="px-6 py-4 space-y-8 w-full">
                <!-- Checklist -->
                <div>
                    <h3 class="font-serif text-xl mb-4 border-l-4 border-muji-primary pl-3">行前準備</h3>
                    <div id="checklist-container" class="space-y-3"></div>
                    <div class="mt-3 flex items-center space-x-3 bg-stone-50 p-3 rounded-lg border border-dashed border-stone-300">
                        <i class="fa-solid fa-plus text-stone-400 ml-1"></i>
                        <input type="text" id="new-checklist-item" placeholder="新增項目..." class="bg-transparent text-sm outline-none w-full" onkeydown="if(event.key === 'Enter') addChecklistItem()">
                    </div>
                </div>
                <!-- Memo -->
                <div>
                    <h3 class="font-serif text-xl mb-4 border-l-4 border-stone-300 pl-3">個人備忘錄</h3>
                    <div class="bg-white rounded-xl shadow-sm border border-stone-200 overflow-hidden group">
                        <textarea id="memo-area" class="w-full h-48 p-4 text-sm leading-relaxed text-stone-700 outline-none resize-none bg-yellow-50/20" placeholder="在此輸入筆記..."></textarea>
                    </div>
                    <div id="memo-links" class="mt-4 flex flex-wrap gap-2"></div>
                </div>
            </div>
        </div>

        <!-- ================= SECTION 4: INFO (資訊) ================= -->
        <div id="section-info" class="page-section">
            <div class="px-6 py-4 space-y-6 w-full">
                <!-- 1. Flight Info -->
                <div class="bg-white rounded-xl p-5 shadow-sm border border-stone-100">
                    <h3 class="text-sm font-bold text-stone-400 mb-3 tracking-wider uppercase">Flights</h3>
                    <div class="mb-4 pb-4 border-b border-stone-100">
                        <div class="flex justify-between text-lg font-bold text-stone-800">
                            <span>HUN</span> <i class="fa-solid fa-plane text-xs text-stone-300 self-center"></i> <span>ICN</span>
                        </div>
                        <div class="flex justify-between text-sm text-muji-sub mt-1">
                            <span>12/18 14:45</span> <span>RF5203</span> <span>18:15</span>
                        </div>
                    </div>
                    <div>
                        <div class="flex justify-between text-lg font-bold text-stone-800">
                            <span>ICN</span> <i class="fa-solid fa-plane text-xs text-stone-300 self-center"></i> <span>HUN</span>
                        </div>
                        <div class="flex justify-between text-sm text-muji-sub mt-1">
                            <span>12/21 11:50</span> <span>RF5193</span> <span>13:30</span>
                        </div>
                    </div>
                </div>
                
                <!-- 2. Weather Widget (Mock) -->
                <div class="bg-white rounded-xl p-5 shadow-sm border border-stone-100 w-full">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-sm font-bold text-stone-400 tracking-wider uppercase">Seoul Weather</h3>
                        <span class="text-[10px] text-stone-300">Source: KMA</span>
                    </div>
                    <div class="flex overflow-x-auto no-scrollbar gap-4 pb-2">
                        <div class="flex flex-col items-center min-w-[60px]"><span class="text-xs text-stone-500 mb-1">12/18</span><i class="fa-solid fa-sun text-2xl text-amber-400 mb-2"></i><span class="text-sm font-bold text-stone-700">8°C</span></div>
                        <div class="flex flex-col items-center min-w-[60px]"><span class="text-xs text-stone-500 mb-1">12/19</span><i class="fa-solid fa-cloud-sun text-2xl text-stone-400 mb-2"></i><span class="text-sm font-bold text-stone-700">10°C</span></div>
                        <div class="flex flex-col items-center min-w-[60px]"><span class="text-xs text-stone-500 mb-1">12/20</span><i class="fa-solid fa-rain text-2xl text-blue-200 mb-2"></i><span class="text-sm font-bold text-stone-700">10°C</span></div>
                        <div class="flex flex-col items-center min-w-[60px]"><span class="text-xs text-stone-500 mb-1">12/21</span><i class="fa-solid fa-sun text-2xl text-stone-300 mb-2"></i><span class="text-sm font-bold text-stone-700">1°C</span></div>
                    </div>
                </div>
                
                <!-- 3. Accommodation -->
                <div class="bg-white rounded-xl p-5 shadow-sm border border-stone-100 relative overflow-hidden w-full">
                    <h3 class="text-sm font-bold text-stone-400 mb-2 tracking-wider uppercase">Accommodation</h3>
                    <h2 class="text-xl font-serif text-stone-800 mb-1">Seoul N Hostel</h2>
                    <p class="text-xs text-stone-500 mb-4 w-3/4">159-16 Mareunnae-ro</p>
                    <a href="https://maps.app.goo.gl/xuu6swMwXezqVpUk6" target="_blank" class="inline-block bg-stone-800 text-white text-xs px-4 py-2 rounded-full shadow-md">
                        <i class="fa-solid fa-map-location-dot mr-1"></i> 導航
                    </a>
                </div>

                <!-- 4. Arrival Card -->
                <div class="bg-white rounded-xl p-5 shadow-sm border border-stone-100 w-full">
                    <h3 class="text-sm font-bold text-stone-400 mb-3 tracking-wider uppercase">Arrival Card</h3>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div class="border border-stone-200 rounded-lg p-2 bg-stone-50 text-center"><span class="text-xs text-stone-500">IMG_2066.jpg</span><br><span class="text-[10px] text-stone-400">(請將照片檔上傳至同目錄)</span></div>
                        <div class="border border-stone-200 rounded-lg p-2 bg-stone-50 text-center"><span class="text-xs text-stone-500">IMG_2067.jpg</span><br><span class="text-[10px] text-stone-400">(請將照片檔上傳至同目錄)</span></div>
                    </div>
                </div>

                <!-- 5. Emergency -->
                <div class="bg-red-50 p-5 rounded-xl border border-red-100 w-full">
                    <h3 class="text-red-800 font-bold mb-3 flex items-center"><i class="fa-solid fa-kit-medical mr-2"></i> 緊急聯絡</h3>
                    <div class="space-y-2 text-sm text-stone-600">
                        <div class="flex justify-between"><span>警察/救護車</span><span class="font-bold text-red-600">112 / 119</span></div>
                        <div class="flex justify-between"><span>外交部緊急</span><span class="font-bold">+82-10-9093-5009</span></div>
                        <div class="flex justify-between"><span>旅館電話</span><span class="font-bold">070-8152-8160</span></div>
                    </div>
                </div>

                 <!-- 6. Tips (Bottom) -->
                <div class="bg-stone-800 text-stone-300 p-5 rounded-xl">
                    <h3 class="text-white font-serif mb-3"><i class="fa-solid fa-triangle-exclamation mr-2 text-amber-500"></i>注意事項 & 禁忌</h3>
                    <ul class="text-sm space-y-2 list-disc list-inside">
                        <li><strong class="text-white">違禁品：</strong>肉類製品(含肉乾、香腸)嚴禁攜帶入境，違者重罰。新鮮水果亦不可入境。</li>
                        <li><strong class="text-white">電壓：</strong>220V，兩孔圓形插座 (需轉接頭)。</li>
                        <li><strong class="text-white">禮儀：</strong>搭乘地鐵請勿坐博愛座。餐廳小菜可免費續加，但請以此為限，勿浪費。</li>
                        <li><strong class="text-white">交通：</strong>Google Maps 僅供查詢大眾運輸，步行導航建議使用 NAVER Map。</li>
                    </ul>
                </div>
                <div class="text-center pt-8">
                    <button onclick="resetApp()" class="text-xs text-stone-300 underline">重置資料 (Reset)</button>
                </div>
            </div>
        </div>

    </main>
    
    <!-- DETAIL MODAL -->
    <div id="detail-modal-overlay" class="modal-overlay" onclick="closeDetailModal(event)">
        <div id="detail-modal-content" class="modal-content" onclick="event.stopPropagation()">
            <div class="sticky top-0 bg-muji-bg px-6 py-4 border-b border-stone-200 flex justify-between items-center z-20">
                <h2 id="modal-title" class="font-serif text-2xl text-stone-800 truncate pr-4"></h2>
                <button onclick="closeDetailModal()" class="text-stone-400 hover:text-stone-800"><i class="fa-solid fa-xmark text-2xl"></i></button>
            </div>
            <div id="modal-body" class="p-6 space-y-6 pb-12">
                <div class="flex items-center gap-2"><span class="bg-stone-200 text-stone-700 px-3 py-1 rounded-full text-xs font-mono font-bold" id="modal-time"></span></div>
                <div id="modal-section-story"><h3 class="font-serif text-lg mb-2 text-stone-800 border-l-4 border-stone-400 pl-2">景點故事</h3><p id="modal-story" class="text-sm text-stone-600 leading-relaxed text-justify"></p></div>
                <div id="modal-section-guide"><h3 class="font-serif text-lg mb-2 text-stone-800 border-l-4 border-stone-400 pl-2">旅遊攻略</h3><p id="modal-guide" class="text-sm text-stone-600 leading-relaxed text-justify"></p></div>
                <div id="modal-tips-container"><h3 class="font-serif text-lg mb-2 text-stone-800 border-l-4 border-muji-highlight pl-2">重點提醒</h3><div id="modal-tips" class="space-y-3"></div></div>
                <div class="pt-4 border-t border-stone-100"><a id="modal-map-link" href="#" target="_blank" class="block w-full text-center bg-stone-800 text-white py-3 rounded-lg shadow-md active:scale-95 transition text-sm font-medium tracking-wide"><i class="fa-solid fa-map-location-dot mr-1"></i> 在地圖上查看</a></div>
            </div>
        </div>
    </div>

    <!-- Nav -->
    <nav class="bg-white border-t border-stone-200 px-6 py-2 pb-5 flex justify-between items-center fixed bottom-0 w-full z-50 text-xs font-medium text-stone-400 shadow-[0_-5px_15px_rgba(0,0,0,0.02)]">
        <button id="nav-plan" onclick="switchTab('plan')" class="nav-btn active flex flex-col items-center gap-1 w-12 text-muji-primary transition-colors"><i class="fa-regular fa-calendar-days text-xl mb-0.5"></i>PLAN</button>
        <button id="nav-wallet" onclick="switchTab('wallet')" class="nav-btn flex flex-col items-center gap-1 w-12 text-stone-400 hover:text-stone-600 transition-colors"><i class="fa-solid fa-wallet text-xl mb-0.5"></i>WALLET</button>
        <button id="nav-lists" onclick="switchTab('lists')" class="nav-btn flex flex-col items-center gap-1 w-12 text-stone-400 hover:text-stone-600 transition-colors"><i class="fa-solid fa-list-check text-xl mb-0.5"></i>LISTS</button>
        <button id="nav-info" onclick="switchTab('info')" class="nav-btn flex flex-col items-center gap-1 w-12 text-stone-400 hover:text-stone-600 transition-colors"><i class="fa-solid fa-circle-info text-xl mb-0.5"></i>INFO</button>
    </nav>

    <!-- JS Logic -->
    <script>
        // No Service Worker Registration for simplicity

        // Data
        const itineraryData = [
            {
                date: "12/18", day: "Day 1",
                events: [
                    { time: "18:15", title: "抵達仁川機場", desc: "降落，準備入境", icon: "fa-plane-arrival" },
                    { time: "19:00", title: "前往市區", desc: "巴士 6001線 或 包車", highlight: true, icon: "fa-bus", link: "https://maps.app.goo.gl/xuu6swMwXezqVpUk6" },
                    { time: "20:30", title: "Check-in", desc: "Seoul N Hostel", icon: "fa-bed", link: "https://maps.app.goo.gl/xuu6swMwXezqVpUk6" },
                    { 
                        time: "21:00", title: "晚餐：烤肉", desc: "選項如下 (點擊導航)：", icon: "fa-utensils", 
                        subItems: [
                            { name: "肉典食堂", query: "https://maps.app.goo.gl/AwpU7SAtDeqDkPC49" },
                            { name: "五花肉大總統", query: "https://maps.app.goo.gl/T5AxezQenBJoT6Hp7" }
                        ],
                        details: { 
                            story: "首爾烤肉文化不可錯過，肉典食堂以其頂級的厚切五花肉和專人代烤出名。五花肉大總統則是以竹筒熟成五花肉為特色。", 
                            guide: "建議避開尖峰時間以免久候。", 
                            tips: [{ type: "必點菜單", text: "厚切五花肉 (Samgyeopsal)、竹筒五花肉。"}] 
                        }
                    },
                    { time: "22:30", title: "宵夜：BHC 炸雞", desc: "＋逛逛附近衣服批發", icon: "fa-drumstick-bite", link: "https://maps.app.goo.gl/GCE9XvyhQftPSuMF6" }
                ]
            },
            {
                date: "12/19", day: "Day 2",
                events: [
                    { time: "Travel", title: "移動", desc: "2014號巴士 12分鐘", isTravel: true, linkUrl: "https://naver.me/FUQxbA0l" },
                    { 
                        time: "08:30", title: "廣藏市場", desc: "綠豆煎餅、麻藥飯捲", icon: "fa-store", link: "Gwangjang Market",
                        details: {
                            story: "廣藏市場是韓國歷史最悠久的傳統市場，起源於1905年。",
                            guide: "市場主要分為美食區和布料區。建議在早上前往。",
                            tips: [
                                { type: "必吃美食", text: "綠豆煎餅 (Bindae-tteok)。" },
                                { type: "必點菜單", text: "麻藥飯捲 (Mayak Gimbap)。" }
                            ]
                        }
                    },
                    { time: "Travel", title: "移動", desc: "巴士 30分鐘", isTravel: true, linkUrl: "https://naver.me/FnVHdQGL" },
                    { 
                        time: "11:00", title: "北村 / 三清洞", desc: "韓屋村散策", icon: "fa-camera", link: "Bukchon Hanok Village",
                        details: {
                            story: "位於景福宮與昌德宮之間，擁有600年歷史。朝鮮時代這裡是王族與高官的居住地。",
                            guide: "尋找「北村八景」，尤其是在坡道上回望首爾塔與韓屋屋簷交錯的畫面。",
                            tips: [{ type: "重點提醒", text: "這裡是居民區，請保持安靜。" }]
                        }
                    },
                    { time: "12:00", title: "午餐", desc: "摩西年糕鍋/牛肉湯/刀切麵", icon: "fa-utensils", subItems: [{name:"年糕鍋", query:"https://maps.app.goo.gl/VzuKUJ2dFFSvtM25A"}, {name:"牛肉湯", query:"https://maps.app.goo.gl/5AZpq3AuQq7nPqBt7"}, {name:"刀切麵", query:"https://maps.app.goo.gl/Yo49wwxWHxUG54Ra8"}] },
                    { time: "Travel", title: "移動", desc: "鐘路11號巴士 30分鐘", isTravel: true, linkUrl: "https://naver.me/5V81ifdD" },
                    { time: "14:30", title: "南大門市場", desc: "卡梅谷包子 / 樂天Outlet", icon: "fa-bag-shopping", subItems: [{name:"卡梅谷包子", query:"https://maps.app.goo.gl/91Jaf4Q5iC7VGjuH9"}, {name:"樂天Outlet", query:"Lotte Outlets Seoul Station"}] },
                    { time: "Travel", title: "移動", desc: "406/401/505巴士 或 走路", isTravel: true, linkUrl: "https://naver.me/xslXSsTO" },
                    { 
                        time: "16:00", title: "N 首爾塔", desc: "搭纜車電梯上山", icon: "fa-tower-broadcast", link: "N Seoul Tower", 
                        details: { 
                            story: "N 首爾塔位於南山頂，是首爾的地標性建築。塔上觀景台提供360度全景視野，冬季夜晚景色尤其壯觀。", 
                            guide: "可以到纜車電梯直上纜車搭乘處。上山有多種方式：纜車、循環巴士(02,03,05號)。若想體驗纜車浪漫，需從明洞站步行至纜車搭乘處", 
                            tips: [{ type: "重要預約代號", text: "如果選擇纜車，建議提前在線上訂票。" }] 
                        } 
                    },
                    { time: "Travel", title: "纜車電梯", desc: "前往搭乘處", isTravel: true, linkUrl: "https://maps.app.goo.gl/vMcPPfzL3UnDCUZ5A" },
                    { time: "Travel", title: "移動", desc: "406/401/143 巴士", isTravel: true, linkUrl: "https://naver.me/5OtHHlQ4" },
                    { 
                        time: "19:00", title: "明洞商圈 & 晚餐", desc: "神仙/味成屋雪濃湯", icon: "fa-shop", 
                        subItems: [
                            {name:"糖葫蘆小哥", query:"https://maps.app.goo.gl/nuMTXwTebz1XCXtUA"}, 
                            {name:"神仙雪濃湯", query:"Sinseon Seolnongtang"}, 
                            {name:"味成屋", query:"Miseongok"}
                        ] 
                    }
                ]
            },
            {
                date: "12/20", day: "Day 3",
                events: [
                    { 
                        time: "07:30", title: "晨間慢跑", desc: "駱山公園", icon: "fa-person-running", link: "Naksan Park",
                        details: {
                            story: "因山形酷似駱駝駝峰而得名。這裡是首爾城郭路的一部分。",
                            guide: "沿著古老的城牆散步，可以俯瞰首爾市區的全景。",
                            tips: [{ type: "重點提醒", text: "單程約 2.1km 上坡，請穿著舒適跑鞋。" }]
                        }
                    },
                    { time: "10:00", title: "東大門早午餐", desc: "香港飯店0410 / 海苔飯捲", icon: "fa-bowl-food", subItems: [{name:"香港飯店", query:"Hong Kong Banjeom"}, {name:"海苔飯捲", query:"https://maps.app.goo.gl/VkmVHP1PaFgTTojW6"}] },
                    { time: "Travel", title: "移動", desc: "地鐵 20分鐘", isTravel: true, linkUrl: "https://naver.me/xnro2gSz" },
                    { time: "12:00", title: "狎鷗亭羅德奧站", desc: "鹽麵包 / HDEX", icon: "fa-bag-shopping", subItems: [{name:"鹽麵包", query:"Jayeondo Sogeumppang"}, {name:"HDEX", query:"HDEX HYM DOSAN"}] },
                    { time: "13:00", title: "醫美行程", desc: "V-moment", highlight: true, icon: "fa-sparkles", link: "https://maps.app.goo.gl/xmni7wxBmHpTjxH48" },
                    { time: "Travel", title: "移動", desc: "巴士 20分鐘", isTravel: true, linkUrl: "https://naver.me/GmtvjJbO" },
                    { 
                        time: "16:00", title: "星空圖書館", desc: "@ Coex Mall", icon: "fa-book-open", link: "Starfield Library",
                        details: {
                            story: "星空圖書館位於 COEX Mall 中心，是首爾的打卡熱點。",
                            guide: "圖書館內座位有限，主要以拍照和休憩為主。",
                            tips: [{ type: "重點提醒", text: "最佳拍攝時間為傍晚，燈光全開時。" }]
                        }
                    },
                    { time: "Travel", title: "移動", desc: "地鐵 50分鐘", isTravel: true, linkUrl: "https://naver.me/FlcwoRT4" },
                    { time: "18:00", title: "聖誕市集", desc: "光化門/清溪川", icon: "fa-tree", link: "Gwanghwamun Square" }
                ]
            },
            {
                date: "12/21", day: "Day 4",
                events: [
                    { time: "07:30", title: "前往機場", desc: "搭 6001 機場巴士", highlight: true, icon: "fa-bus" },
                    { time: "11:50", title: "飛機起飛", desc: "RF5193", icon: "fa-plane-departure" },
                    { time: "13:30", title: "抵達溫暖的家", desc: "Home", icon: "fa-house" }
                ]
            }
        ];

        // Default List
        const defaultChecklist = [{text:"護照", checked:false}, {text:"網卡", checked:false}, {text:"轉接頭", checked:false}, {text:"T-money", checked:false}];

        // Init
        document.addEventListener('DOMContentLoaded', () => {
            renderPlanTabs(); renderPlanContent(0); initWallet(); initLists();
        });

        // Navigation (Updated Logic)
        function switchTab(tabId) {
            document.querySelectorAll('.page-section').forEach(el => el.classList.remove('active'));
            document.getElementById(`section-${tabId}`).classList.add('active');
            document.querySelectorAll('.nav-btn').forEach(btn => { btn.classList.remove('text-muji-primary'); btn.classList.add('text-stone-400'); });
            const activeBtn = document.getElementById(`nav-${tabId}`);
            if(activeBtn) { activeBtn.classList.remove('text-stone-400'); activeBtn.classList.add('text-muji-primary'); }
            window.scrollTo(0,0);
        }

        // Plan Logic
        function renderPlanTabs() {
            document.getElementById('day-tabs').innerHTML = itineraryData.map((d,i) => `
                <button onclick="renderPlanContent(${i})" class="day-tab-btn flex-shrink-0 px-5 py-2 rounded-full text-sm font-medium transition-all ${i===0?'bg-stone-800 text-white shadow-md':'bg-white text-stone-500 border border-stone-200'}">
                    <span class="block text-xs opacity-70">${d.date}</span><span>${d.day}</span>
                </button>`).join('');
        }
        function renderPlanContent(idx) {
            document.querySelectorAll('.day-tab-btn').forEach((btn, i) => btn.className = i===idx ? "day-tab-btn flex-shrink-0 px-5 py-2 rounded-full text-sm font-medium transition-all bg-stone-800 text-white shadow-md transform scale-105" : "day-tab-btn flex-shrink-0 px-5 py-2 rounded-full text-sm font-medium transition-all bg-white text-stone-500 border border-stone-200");
            
            document.getElementById('itinerary-content').innerHTML = itineraryData[idx].events.map((e, i) => {
                if(e.isTravel) {
                    let link = e.linkUrl ? `<a href="${e.linkUrl}" target="_blank" class="ml-1 text-muji-highlight"><i class="fa-solid fa-arrow-up-right-from-square"></i></a>` : '';
                    return `<div class="flex items-center gap-4 bg-stone-100 p-3 rounded-xl border border-stone-200"><i class="fa-solid fa-route text-2xl text-stone-400 min-w-[30px] text-center"></i><div class="flex-1"><h4 class="font-bold text-stone-700">${e.title}</h4><div class="text-xs text-stone-500 font-mono">${e.desc} ${link}</div></div></div>`;
                }
                let links = '';
                if(e.link) links = `<a href="${e.link.startsWith('http')?e.link:'https://maps.google.com/?q='+e.link}" target="_blank" onclick="event.stopPropagation()" class="inline-block mt-2 text-xs bg-stone-100 text-stone-600 px-3 py-1.5 rounded-md"><i class="fa-solid fa-map-location-dot"></i> 地圖</a>`;
                if(e.subItems) links = '<div class="mt-3 flex flex-wrap gap-2">' + e.subItems.map(s => `<a href="${s.query.startsWith('http')?s.query:'https://maps.google.com/?q='+s.query}" target="_blank" onclick="event.stopPropagation()" class="inline-block text-xs border border-stone-200 text-stone-600 px-3 py-1.5 rounded-md hover:bg-stone-50"><i class="fa-solid fa-location-dot mr-1"></i> ${s.name}</a>`).join('') + '</div>';
                
                return `<div class="flex gap-4"><div class="flex flex-col items-center min-w-[50px]"><span class="${e.highlight?'text-muji-highlight font-bold':'text-stone-800 font-medium'} text-sm font-mono pt-4">${e.time}</span><div class="h-full w-px bg-stone-200 my-2 relative"><div class="absolute top-0 left-1/2 transform -translate-x-1/2 w-2 h-2 rounded-full ${e.highlight?'bg-muji-highlight':'bg-stone-300'}"></div></div></div><div class="flex-1 pb-6 pt-2"><div onclick="openDetailModal(${idx}, ${i})" class="${e.highlight?'border-l-4 border-muji-highlight bg-amber-50/50':'border-l-2 border-stone-200 bg-white'} p-4 rounded-r-xl rounded-bl-xl shadow-sm relative active:scale-[0.99] cursor-pointer"><div class="flex justify-between items-start"><h4 class="font-bold text-stone-800 text-base">${e.title}</h4><i class="fa-solid ${e.icon} text-stone-300"></i></div><p class="text-sm text-muji-sub mt-1 leading-snug">${e.desc.replace(/\n/g,'<br>')}</p>${links}</div></div></div>`;
            }).join('');
        }

        // Modal Logic
        function openDetailModal(dIdx, eIdx) {
            const e = itineraryData[dIdx].events[eIdx];
            if(!e.details) { if(e.link && e.link.startsWith('http')) window.open(e.link); return; }
            document.getElementById('modal-title').innerText = e.title;
            document.getElementById('modal-time').innerText = e.time;
            document.getElementById('modal-story').innerText = e.details.story || "";
            document.getElementById('modal-guide').innerText = e.details.guide || "";
            
            const tips = document.getElementById('modal-tips');
            tips.innerHTML = (e.details.tips||[]).map(t => `<div class="p-3 rounded-lg border bg-stone-50 border-stone-200"><strong class="text-xs font-bold block mb-0.5">${t.type}</strong><p class="text-sm">${t.text}</p></div>`).join('');
            document.getElementById('modal-tips-container').style.display = e.details.tips ? 'block' : 'none';
            
            document.getElementById('modal-map-link').href = e.link && e.link.startsWith('http') ? e.link : '#';
            document.getElementById('detail-modal-overlay').classList.add('active');
        }
        function closeDetailModal(e) { if(!e || e.target.id === 'detail-modal-overlay') document.getElementById('detail-modal-overlay').classList.remove('active'); }

        // Wallet Logic (FIXED: Remove Comma, Remove Category)
        function initWallet() { if(localStorage.getItem('krw_rate')) document.getElementById('exchange-rate').value = localStorage.getItem('krw_rate'); renderExpenseList(); }
        function updateRate() { localStorage.setItem('krw_rate', document.getElementById('exchange-rate').value); renderExpenseList(); calculateTotal(); }
        
        function calculateTotal() {
            let val = document.getElementById('calc-input').value;
            const rate = parseFloat(document.getElementById('exchange-rate').value)||42;
            const cleanVal = val.replace(/,/g, ''); 
            try { 
                if(/^[0-9+\-*/.() ]*$/.test(cleanVal) && cleanVal.trim()!=="") { 
                    const res = new Function('return '+cleanVal)(); 
                    if(isFinite(res)) { 
                        document.getElementById('calc-result-krw').innerText = Math.round(res).toLocaleString()+" ₩"; 
                        document.getElementById('calc-result-twd').innerText = "NT$ "+Math.round(res/rate).toLocaleString(); 
                    } 
                } 
            } catch(e){}
        }
        
        function copyCalcToExpense() {
            const val = document.getElementById('calc-result-krw').innerText.replace(/[^0-9]/g,'');
            if(val != "0") { document.getElementById('expense-amount').value = val; document.getElementById('expense-name').focus(); }
        }
        
        function addExpense() {
            const name = document.getElementById('expense-name').value;
            const amt = parseFloat(document.getElementById('expense-amount').value);
            const payer = document.getElementById('expense-payer').value;
            // No category variable used
            if(!name || isNaN(amt)) return;
            const expenses = JSON.parse(localStorage.getItem('expenses')||'[]');
            expenses.unshift({id: Date.now(), name, amount: amt, payer, date: new Date().toLocaleDateString()});
            localStorage.setItem('expenses', JSON.stringify(expenses));
            document.getElementById('expense-name').value=''; document.getElementById('expense-amount').value='';
            renderExpenseList();
        }
        
        function deleteExpense(id) {
            const expenses = JSON.parse(localStorage.getItem('expenses')||'[]');
            localStorage.setItem('expenses', JSON.stringify(expenses.filter(e => e.id !== id)));
            renderExpenseList();
        }
        
        function renderExpenseList() {
            const expenses = JSON.parse(localStorage.getItem('expenses')||'[]');
            const rate = parseFloat(document.getElementById('exchange-rate').value)||42;
            let total=0, k=0, n=0;
            document.getElementById('expense-list').innerHTML = expenses.map(e => {
                const twd = Math.round(e.amount/rate); total+=twd;
                if(e.payer==='Kathy') k+=twd; else n+=twd;
                return `<li class="bg-white p-3 rounded-lg shadow-sm border border-stone-100 flex justify-between items-center"><div><div class="flex items-center gap-2 mb-1"><span class="text-[10px] font-bold px-1.5 py-0.5 rounded ${e.payer==='Nick'?'bg-stone-600 text-white':'bg-stone-200 text-stone-600'}">${e.payer}</span><div class="font-medium text-stone-700">${e.name}</div></div><div class="text-xs text-stone-400">${e.date}</div></div><div class="text-right flex items-center gap-3"><div><div class="text-sm font-bold text-stone-800">₩${e.amount.toLocaleString()}</div><div class="text-xs text-muji-sub">≈ NT$${twd.toLocaleString()}</div></div><button onclick="deleteExpense(${e.id})" class="text-stone-300 hover:text-red-400 px-2"><i class="fa-solid fa-trash-can"></i></button></div></li>`;
            }).join('');
            document.getElementById('total-twd').innerText = `NT$ ${total.toLocaleString()}`;
            document.getElementById('total-kathy').innerText = `NT$ ${k.toLocaleString()}`;
            document.getElementById('total-nick').innerText = `NT$ ${n.toLocaleString()}`;
        }

        // Lists Logic
        function initLists() {
            let list = JSON.parse(localStorage.getItem('checklist'));
            if(!list) { list = defaultChecklist; localStorage.setItem('checklist', JSON.stringify(list)); }
            renderChecklist();
            const memo = localStorage.getItem('user_memo')||'';
            document.getElementById('memo-area').value = memo; extractLinks(memo);
            document.getElementById('memo-area').addEventListener('input', e => { localStorage.setItem('user_memo', e.target.value); extractLinks(e.target.value); });
        }
        function renderChecklist() {
            const list = JSON.parse(localStorage.getItem('checklist'));
            document.getElementById('checklist-container').innerHTML = list.map((item, i) => `<div class="flex items-center space-x-3 bg-white p-3 rounded-lg shadow-sm border border-stone-100 group"><input type="checkbox" class="muji-checkbox w-5 h-5 flex-shrink-0 rounded border-stone-300 text-stone-600 focus:ring-stone-500" ${item.checked?'checked':''} onchange="toggleCheck(${i})"><input type="text" class="input-ghost text-sm text-stone-700 ${item.checked?'line-through opacity-50':''}" value="${item.text}" onchange="updateChecklistText(${i}, this.value)"><button onclick="deleteChecklistItem(${i})" class="text-stone-300 hover:text-red-400 px-2 opacity-0 group-hover:opacity-100 transition-opacity"><i class="fa-solid fa-xmark"></i></button></div>`).join('');
        }
        function toggleCheck(i) { const l = JSON.parse(localStorage.getItem('checklist')); l[i].checked = !l[i].checked; localStorage.setItem('checklist', JSON.stringify(l)); renderChecklist(); }
        function updateChecklistText(i, val) { const l = JSON.parse(localStorage.getItem('checklist')); l[i].text = val; localStorage.setItem('checklist', JSON.stringify(l)); }
        function addChecklistItem() { const val = document.getElementById('new-checklist-item').value.trim(); if(val) { const l = JSON.parse(localStorage.getItem('checklist'))||[]; l.push({text:val, checked:false}); localStorage.setItem('checklist', JSON.stringify(l)); document.getElementById('new-checklist-item').value=''; renderChecklist(); } }
        function deleteChecklistItem(i) { const l = JSON.parse(localStorage.getItem('checklist')); l.splice(i, 1); localStorage.setItem('checklist', JSON.stringify(l)); renderChecklist(); }
        function extractLinks(text) { const m = text.match(/(https?:\/\/[^\s]+)/g); document.getElementById('memo-links').innerHTML = m ? m.map(u => `<a href="${u}" target="_blank" class="text-xs bg-stone-200 text-stone-600 px-2 py-1 rounded hover:bg-stone-300 truncate max-w-[150px] block"><i class="fa-solid fa-link mr-1"></i>連結</a>`).join('') : ''; }
        function resetApp() { if(confirm('確定重置?')) { localStorage.clear(); location.reload(); } }
    </script>
</body>
</html>
